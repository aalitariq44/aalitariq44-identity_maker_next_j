# محرر الهويات المتقدم - Identity Maker Next.js

محرر هويات متقدم وقوي مبني بـ Next.js 14 مع مكتبة Konva.js لإنشاء وتحرير بطاقات الهوية والبطاقات التعريفية بشكل احترافي.

## 🚀 الميزات الجديدة والتحسينات الجذرية

### 🔧 إصلاحات رئيسية
- ✅ **إصلاح مشكلة إدارة الطبقات**: الآن تغيير ترتيب الطبقات يظهر فوراً على الكانفاس
- ✅ **تحسين نظام التحديد**: تحديد دقيق للعناصر بناءً على ترتيب الطبقات (Z-index)
- ✅ **نظام Undo/Redo محسن**: تتبع ذكي للتغييرات مع عدم حفظ الحركات البسيطة
- ✅ **رسم الأشكال بترتيب صحيح**: العناصر تُرسم بناءً على Z-index الصحيح

### 🎨 شريط أدوات متقدم
- **أدوات تحديد وتحريك متقدمة**
- **إضافة سريعة للأشكال** (مستطيل، دائرة، مثلث، نص، صور)
- **عناصر خاصة بالهوية** (صورة شخصية، QR، باركود)
- **تحكم في التكبير والتصغير**
- **إظهار/إخفاء الشبكة**
- **اختصارات لوحة المفاتيح**

### 📱 إدارة طبقات متطورة
- **بحث في الطبقات** بالاسم أو المعرف
- **فلترة حسب نوع العنصر**
- **تحديد متعدد** (Ctrl+Click, Shift+Click)
- **إعادة ترتيب بالسحب والإفلات**
- **إجراءات جماعية** (إخفاء، إظهار، قفل، حذف)
- **معاينة مصغرة للطبقات**
- **مؤشرات حالة العناصر** (مخفي، مقفل، محدد)

### ⚙️ لوحة خصائص شاملة
- **تبويبات منظمة** (العنصر، القماش)
- **تحكم دقيق في الموضع والحجم**
- **تدوير العناصر** مع شريط تمرير
- **شفافية العناصر**
- **خصائص خاصة لكل شكل**:
  - المستطيلات: ألوان التعبئة والحدود
  - الدوائر: نصف القطر والألوان
  - النصوص: محتوى، حجم الخط، نوع الخط، لون
- **إعدادات القماش**: الحجم، الخلفية، الشبكة

### 🖱️ تفاعل متطور مع الكانفاس
- **تحديد متعدد** مع مربع التحديد
- **تحريك عناصر متعددة** معاً
- **تكبير وتصغير** متقدم
- **تحريك القماش** (Pan) بمفتاح Space
- **تدوير العناصر** مع مقبض خاص
- **تغيير حجم العناصر** بمقابض دقيقة
- **التقاط للشبكة** (Snap to Grid)

### ⌨️ اختصارات لوحة المفاتيح
- `V` - أداة التحديد
- `H` - أداة التحريك (Hand)
- `R` - إضافة مستطيل
- `O` - إضافة دائرة
- `T` - إضافة نص
- `P` - إضافة صورة شخصية
- `Q` - إضافة QR كود
- `B` - إضافة باركود
- `Ctrl+Z` - تراجع
- `Ctrl+Y` - إعادة
- `Ctrl+C` - نسخ
- `Ctrl+V` - لصق
- `Ctrl+D` - تكرار
- `Ctrl+A` - تحديد الكل
- `Delete/Backspace` - حذف
- `Escape` - إلغاء التحديد
- `Arrow Keys` - تحريك دقيق (Shift للحركة السريعة)
- `Space + Mouse` - تحريك القماش

### 🎯 تحسينات الأداء
- **رسم محسن** للأشكال مع تفاصيل أفضل
- **إدارة ذاكرة محسنة** للعمليات المتكررة
- **تحديث انتقائي** للعناصر المتغيرة فقط
- **معالجة أحداث محسنة** للتفاعل السلس

## 🛠️ التقنيات المستخدمة

- **Next.js 14** - إطار العمل الرئيسي
- **TypeScript** - للبرمجة الآمنة
- **Zustand** - لإدارة الحالة
- **Tailwind CSS** - للتصميم
- **Lucide React** - للأيقونات
- **HTML5 Canvas** - للرسم والتفاعل
- **jsPDF** - لتصدير PDF
- **html2canvas** - لتصدير الصور

## 📦 التثبيت والتشغيل

```bash
# استنساخ المشروع
git clone [repository-url]
cd identity_maker_next_js

# تثبيت التبعيات
npm install

# تشغيل الخادم التطويري
npm run dev
```

## 🎮 كيفية الاستخدام

### الأساسيات
1. **إضافة عناصر**: استخدم الأزرار في شريط الأدوات أو الاختصارات
2. **تحديد العناصر**: انقر على العنصر أو استخدم مربع التحديد
3. **تحريك العناصر**: اسحب العناصر المحددة
4. **تغيير الحجم**: اسحب المقابض حول العنصر المحدد
5. **تدوير**: اسحب المقبض الأخضر فوق العنصر

### الميزات المتقدمة
- **تحديد متعدد**: Ctrl+Click لإضافة عناصر للتحديد
- **تحديد مجال**: اسحب لرسم مربع تحديد
- **تحريك القماش**: اضغط Space واسحب
- **تكبير/تصغير**: استخدم أزرار التكبير أو عجلة الماوس
- **إدارة طبقات**: استخدم لوحة الطبقات لإعادة الترتيب والتحكم

### التخصيص
- **الألوان**: استخدم منتقي الألوان في لوحة الخصائص
- **النصوص**: غيّر المحتوى والخط والحجم
- **الشبكة**: فعّل الشبكة والتقاط إليها من إعدادات القماش
- **الخلفية**: غيّر لون خلفية القماش

## 📁 هيكل المشروع

```
src/
├── app/
│   ├── page.tsx              # الصفحة الرئيسية
│   └── editor/
│       └── page.tsx          # صفحة المحرر
├── components/
│   └── editor/
│       ├── AdvancedToolbar.tsx        # شريط الأدوات المتطور
│       ├── AdvancedLayersPanel.tsx    # لوحة الطبقات المتطورة
│       ├── AdvancedPropertiesPanel.tsx # لوحة الخصائص الشاملة
│       ├── AdvancedCanvasStage.tsx    # الكانفاس المتطور
│       └── ...               # مكونات أخرى
├── store/
│   └── useEditorStore.ts     # إدارة حالة المحرر
├── types/
│   └── shapes.ts             # أنواع البيانات
├── lib/
│   ├── konvaUtils.ts         # أدوات الرسم
│   └── exportUtils.ts        # أدوات التصدير
└── ...
```

## 🔄 مقارنة مع الإصدار السابق

| الميزة | الإصدار السابق | الإصدار الجديد |
|--------|----------------|----------------|
| إدارة الطبقات | مشكلة في التزامن | متزامنة 100% مع الكانفاس |
| التحديد | أساسي | متقدم مع تحديد متعدد |
| التفاعل | محدود | شامل مع اختصارات |
| الأداء | متوسط | محسن بشكل كبير |
| سهولة الاستخدام | جيدة | ممتازة مثل Canva |
| الميزات | أساسية | متقدمة ومهنية |

## 🚀 الميزات المستقبلية المخططة

- [ ] **طبقات متقدمة**: مجموعات، قفل الطبقات
- [ ] **تأثيرات بصرية**: ظلال، توهج، شفافية متدرجة
- [ ] **قوالب جاهزة**: مكتبة قوالب بطاقات هوية
- [ ] **تعاون فوري**: تحرير متعدد المستخدمين
- [ ] **تصدير متقدم**: SVG، PDF عالي الجودة
- [ ] **استيراد الصور**: دعم سحب وإفلات للصور
- [ ] **خطوط مخصصة**: دعم الخطوط العربية والإنجليزية
- [ ] **رسم حر**: أداة الرسم اليدوي
- [ ] **طباعة مباشرة**: إعداد الطباعة والمعاينة

## 🐛 الإصلاحات في هذا الإصدار

1. **مشكلة ترتيب الطبقات**: تم إصلاح عدم تطابق ترتيب الطبقات مع الرسم
2. **مشكلة التحديد**: تحسين دقة تحديد العناصر المتداخلة
3. **مشكلة الأداء**: تحسين الرسم والتفاعل للاستجابة السريعة
4. **مشكلة التاريخ**: إصلاح نظام Undo/Redo ليعمل بشكل مثالي
5. **مشكلة التكبير**: تحسين جودة الرسم مع التكبير

## 📝 الملاحظات التقنية

- استخدام `zustand` مع `immer` لإدارة حالة معقدة وآمنة
- تحسين الأداء باستخدام `useCallback` و `useMemo`
- رسم محسن باستخدام HTML5 Canvas المحلي بدلاً من Konva للتحكم الكامل
- دعم التفاعل المتقدم مع الكانفاس
- إدارة ذكية للذاكرة وتنظيف الموارد

## 🤝 المساهمة

نرحب بالمساهمات! يرجى اتباع الخطوات التالية:

1. Fork المشروع
2. إنشاء فرع للميزة الجديدة
3. تطوير التحسين أو الإضافة
4. اختبار التغييرات
5. إرسال Pull Request

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT - راجع ملف [LICENSE](LICENSE) للتفاصيل.

---

تم تطوير هذا المشروع بعناية ليكون أداة احترافية لتصميم بطاقات الهوية مع واجهة سهلة الاستخدام وميزات متقدمة تنافس أدوات التصميم التجارية. 🎨✨

# ميزة الوجهين في محرر الهويات

## نظرة عامة

تم إضافة ميزة جديدة لدعم تصميم وجهين للهوية (الوجه الأمامي والوجه الخلفي) مع إمكانية التبديل السلس بينهما وتصدير كل وجه منفصلاً أو كلاهما معاً.

## الميزات الجديدة

### 1. دعم الوجهين
- **الوجه الأمامي**: يحتوي على المعلومات الأساسية والصورة الشخصية
- **الوجه الخلفي**: يحتوي على معلومات إضافية أو تفاصيل أخرى
- كل وجه له تصميم منفصل ومستقل

### 2. مكونات التبديل بين الوجهين

#### أ) مبدل سريع في الشريط العلوي (QuickSideSwitcher)
- أزرار سريعة للتبديل بين الوجهين
- عرض عدد العناصر في كل وجه
- مؤشر بصري للوجه النشط حالياً

#### ب) مبدل مفصل في اللوحة الجانبية (CardSideSwitcher)
- عرض تفصيلي لكل وجه
- إمكانية التبديل السريع
- عرض حالة كل وجه

#### ج) لوحة المعاينة (CardPreviewPanel)
- معاينة مصغرة لكلا الوجهين
- إمكانية النقر للتبديل
- عرض بصري مبسط للعناصر في كل وجه

### 3. نظام التخزين المحسن

#### إدارة البيانات
- كل وجه يحتفظ ببياناته منفصلة (الأشكال وإعدادات الخلفية)
- التبديل التلقائي لحفظ البيانات عند التنقل بين الوجهين
- دعم الإصدارات القديمة من المشاريع (تحويل تلقائي)

#### الحفظ والتحميل
- دعم حفظ المشاريع بصيغة جديدة تتضمن الوجهين
- تحميل المشاريع القديمة مع تحويلها تلقائياً
- الاحتفاظ بالتوافق مع النسخة السابقة

### 4. التصدير المحسن

#### خيارات التصدير
- **الوجه الحالي فقط**: تصدير الوجه النشط فقط
- **كلا الوجهين**: تصدير الوجهين في ملفين منفصلين

#### صيغ التصدير المدعومة
- PNG (جودة عالية مع شفافية)
- JPG (حجم ملف صغير)
- PDF (جودة طباعة احترافية)

#### أسماء الملفات
- الوجه الأمامي: `identity-card-front.png`
- الوجه الخلفي: `identity-card-back.png`

## كيفية الاستخدام

### 1. التبديل بين الوجهين
```typescript
// استخدام مخزن البيانات
const { currentSide, switchToSide } = useEditorStore()

// التبديل إلى الوجه الأمامي
switchToSide('front')

// التبديل إلى الوجه الخلفي
switchToSide('back')
```

### 2. الحصول على بيانات الوجه الحالي
```typescript
const { getCurrentSideData } = useEditorStore()
const sideData = getCurrentSideData()
```

### 3. مزامنة البيانات
```typescript
const { syncCurrentSideData } = useEditorStore()
syncCurrentSideData() // حفظ بيانات الوجه الحالي
```

## الملفات المضافة/المحدثة

### الملفات الجديدة
- `src/components/editor/CardSideSwitcher.tsx` - مبدل الوجهين المفصل
- `src/components/editor/QuickSideSwitcher.tsx` - مبدل الوجهين السريع
- `src/components/editor/CardPreviewPanel.tsx` - لوحة معاينة الوجهين

### الملفات المحدثة
- `src/types/shapes.ts` - إضافة أنواع البيانات للوجهين
- `src/store/useEditorStore.ts` - تحديث نظام إدارة البيانات
- `src/app/editor/page.tsx` - دمج المكونات الجديدة
- `src/components/editor/ExportModal.tsx` - دعم تصدير الوجهين

## التحسينات التقنية

### 1. إدارة الحالة
- فصل بيانات كل وجه بشكل مستقل
- مزامنة تلقائية عند التبديل
- حفظ تلقائي للتغييرات

### 2. الأداء
- تحميل كسول للمكونات
- تحديث محدود للواجهة عند التبديل
- معاينة مبسطة للوجهين

### 3. تجربة المستخدم
- مؤشرات بصرية واضحة
- تبديل سلس بدون فقدان البيانات
- رسائل تأكيد وحالة واضحة

## مثال عملي

```typescript
// في مكون React
function MyComponent() {
  const { 
    currentSide, 
    switchToSide, 
    frontSide, 
    backSide 
  } = useEditorStore()

  const handleSwitchToBack = () => {
    switchToSide('back')
  }

  return (
    <div>
      <p>الوجه الحالي: {currentSide === 'front' ? 'أمامي' : 'خلفي'}</p>
      <p>عناصر الوجه الأمامي: {frontSide.shapes.length}</p>
      <p>عناصر الوجه الخلفي: {backSide.shapes.length}</p>
      <button onClick={handleSwitchToBack}>
        التبديل إلى الوجه الخلفي
      </button>
    </div>
  )
}
```

## المشاكل المحلولة

1. **فقدان البيانات عند التبديل**: تم حلها بنظام المزامنة التلقائية
2. **التوافق مع المشاريع القديمة**: تم إضافة نظام تحويل تلقائي
3. **تعقيد التصدير**: تم تبسيطه مع خيارات واضحة
4. **الأداء**: تم تحسينه بالتحميل الكسول والتحديث المحدود

## التطوير المستقبلي

- إضافة إمكانية نسخ العناصر بين الوجهين
- دعم المزيد من القوالب للوجه الخلفي
- إضافة معاينة ثلاثية الأبعاد للبطاقة
- دعم الطباعة المباشرة للوجهين

## الخلاصة

تم بنجاح إضافة ميزة الوجهين للهوية مع الحفاظ على البساطة وسهولة الاستخدام. المستخدم يمكنه الآن تصميم هوية كاملة بوجهين مع إمكانية التبديل السلس والتصدير المرن.
